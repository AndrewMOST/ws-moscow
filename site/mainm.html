<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
    <link rel="stylesheet" href="css/icon.css">

    <!-- Подключаем Jquery -->
    <script src="js/jquery-3.3.1.js"></script>
    <title>Служба поддержки</title>
    <!-- Подключаем Materialize css -->
    <link rel="stylesheet" href="css/materialize.min.css">
    <link rel="stylesheet" href="css/index.css">

  </head>
  <body>
    <div id="app">
        <div class="container"><div class="card"><div class="card-content">
          <a href="javascript:quit()" class="waves-effect btn-flat white-text"><i class="material-icons left">keyboard_arrow_left</i>Выйти</a>

          <h4>Заявки</h4>

          <ul id="tabs-swipe" class="tabs tabs-fixed-width tab-demo z-depth-1 tabs-custom">
              <li class="tab col s6"><a class="active" href="#available">Доступные</a></li>
              <li class="tab col s6"><a href="#taken">Взятые</a></li>
          </ul>
          <!-- Доступные заявки -->
          <div id="available" class="col s12">
              <ul class="collection with-header"></ul>
          </div>

          <!-- Взятые заявки -->
          <div id="taken" class="col s12">
              <ul class="collection with-header"></ul>
          </div>

        </div></div></div>
    </div>
    
    
    <!-- Modal Structure -->
    <div id="modal1" class="modal">
        <div class="modal-content">
        <h4>Вы забанены</h4>
        <p>К сожалению, ваш аккаунт был заблокирован за слишком низкий рейтинг среди пользователей!</p>
        </div>
        <div class="modal-footer">
        <a class="modal-close waves-effect waves-green btn-flat">Ок</a>
        </div>
    </div>

  </body>
      <!-- Подключаем Jquery -->
      <script src="js/jquery-3.3.1.js"></script>
  <!-- Подключаем Materialize js и скрипты-->
  <script src="js/moderscript.js"></script>
  <script src="js/materialize.min.js"></script>

    <script>
        $(document).ready(function(){
            $('.modal').modal();
            $('.tabs').tabs({swipeable:true, duration: 200});
            getapplications();
            setInterval('getapplications()', 1000);
        });
    </script>
    <script>
        // Функция для взятия заявки
        function take_app(id){
            $.post('/take_app', {moderator: window.localStorage.login, id: id}).done(
                (data) => {
                    if (data === ''){
                        console.log('Нельзя взять заявку');
                        return false;
                    }
                    if (data === 'frozen'){
                        $('#modal1').modal('open');
                        console.log('К сожалению, ваш аккаунт был заблокирован за слишком низкий рейтинг среди пользователей!')
                        return false;
                    }
                    else{
                        console.log('Вы взяли заявку');
                        getapplications();
                        get_app();
                    }
                }
            ).fail(()=>{console.log('Нельзя взять заявку');});
        }
    </script>
</html>
